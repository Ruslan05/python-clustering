{% extends "base.html" %}
{% block content %}
<p>
    <div class="btn-group">
      <button type="button" class="btn btn-default">Choose table</button>
      <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
      <ul class="dropdown-menu">
            <li><a href="#">Clusters</a></li>
            <li class="divider"></li>
            <li><a href="#">output1</a></li>
            <li class="divider"></li>
            <li><a href="#">output2</a></li>
            <li class="divider"></li>
      </ul>
    </div><!-- /btn-group -->
</p>

<div class="row">
    <div class="col-lg-12">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title"><i class="fa fa-bar-chart-o"></i> Clusters </h3>
            </div>
            <div class="panel-body">

                <div id="shieldui-grid1"></div>
            </div>
        </div>
    </div>
</div>

    <script type="text/javascript">
        jQuery(function ($) {
            var spinner = new Spinner({color: 'white'}).spin(),
                performance = [12, 43, 34, 22, 12, 33, 4, 17, 22, 34, 54, 67],
                visits = [123, 323, 443, 32];
            initGrid();
            $('.panel-body').append(spinner.el);

            $("#shieldui-chart1").shieldChart({
                theme: "dark",

                primaryHeader: {
                    text: "Visitors"
                },
                exportOptions: {
                    image: false,
                    print: false
                },
                dataSeries: [{
                    seriesType: "area",
                    collectionAlias: "Q Data",
                    data: performance
                }]
            });

            $("#shieldui-chart2").shieldChart({
                theme: "dark",
                primaryHeader: {
                    text: "Traffic Per week"
                },
                exportOptions: {
                    image: false,
                    print: false
                },
                dataSeries: [{
                    seriesType: "pie",
                    collectionAlias: "traffic",
                    data: visits
                }]
            });

            function fillGrid(titles, content){
                    $("#shieldui-grid1").shieldGrid({
                    dataSource: {
                        data: content
                    },
                    sorting: {
                        multiple: true
                    },
                    paging: {
                        pageSize: 12,
                        pageLinksCount: 10
                    },
                    filtering: {
                        enabled: true
                    },
                    rowHover: false,
                    columns: titles,
                    toolbar: [
                        {
                            buttons: [
                                {
                                    commandName: "pdf",
                                    caption: '<span class="sui-sprite sui-grid-icon-export-pdf"></span> <span class="sui-grid-button-text">Export to PDF</span>'
                                },
                                {
                                    commandName: "excel",
                                    caption: '<span class="sui-sprite sui-grid-icon-export-excel"></span> <span class="sui-grid-button-text">Export to Excel</span>'
                                }
                            ]
                        }
                    ],
                    exportOptions: {
                        proxy: "/filesaver/save",
                        pdf: {
                            fileName: "export",
                            author: "azure ml",
                            dataSource: {
                                data: content
                            },
                            readDataSource: true,
                            header: {
                                cells: titles
                            }
                        },
                        excel: {
                            fileName: "export",
                            author: "azure ml",
                            dataSource: {
                                data: content
                            },
                            readDataSource: true
                        }
                    }
                });
            }

            function initGrid(){
                $.ajax({
                    type: "POST",
                    url: "/ajax",
                    dataType: "json",
                    data: {'request':'clusters'},
                    success: function(response) {
                        var titlesIndex = 0,
                            contentIndex = 1,
                            data,
                            content = [];

                        data = JSON.parse(response);
                        for(var i=0;i<data[contentIndex].length;i++) {
                            content.push(data[contentIndex][i][0]);
                        }
                        fillGrid(data[titlesIndex], content)
                    },
                    complete:function () {
                        $('.spinner').remove();
                    }
                });
            }
        });
    </script>
{% endblock %}

